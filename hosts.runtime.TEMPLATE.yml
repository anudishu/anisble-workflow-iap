# =========================================================================
# ANSIBLE IAP INVENTORY - AUTHENTICATION TEMPLATE
# =========================================================================
# 
# This file shows what needs to be changed for different users to run
# the Ansible code with their own authentication credentials.
# 
# COPY this file to hosts.runtime.yml and customize the values below.
# =========================================================================

# =======================================================================
# FOR SHIVANI KHETANI - EXAMPLE CONFIGURATION
# =======================================================================
all:
  children:
    targets:
      hosts:
        ansible-rhel9-vm:                                    # âœ… VM name (update if different)
          ansible_host: ansible-rhel9-vm                     # âœ… VM name or IP
          ansible_user: shivani_khetani                      # ðŸ”„ CHANGE: Your SSH username
          ansible_ssh_common_args: >-
            -o ProxyCommand="gcloud compute start-iap-tunnel ansible-rhel9-vm 22 
            --listen-on-stdin --project=YOUR-PROJECT-ID --zone=YOUR-ZONE 
            --verbosity=warning" 
            -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null
          ansible_ssh_private_key_file: '/Users/shivani/.ssh/ansible_key'  # ðŸ”„ CHANGE: Your SSH key path
          ansible_python_interpreter: auto_silent            # âœ… Keep as is
      vars:
        # IAP-based connection for secure access
        gcp_project: "YOUR-PROJECT-ID"                       # ðŸ”„ CHANGE: Your GCP project
        gcp_zone: "YOUR-ZONE"                               # ðŸ”„ CHANGE: Your VM zone

# =======================================================================
# WHAT EACH USER NEEDS TO CHANGE:
# =======================================================================

# ðŸ”„ REQUIRED CHANGES FOR ANY USER:
# 
# 1. ansible_user: "shivani_khetani"
#    â†’ Change to your SSH username (usually: firstname_lastname)
#
# 2. ansible_ssh_private_key_file: '/Users/shivani/.ssh/ansible_key'
#    â†’ Change to YOUR SSH private key file path
#
# 3. gcp_project: "YOUR-PROJECT-ID"  
#    â†’ Change to your GCP project ID
#
# 4. gcp_zone: "YOUR-ZONE"
#    â†’ Change to your VM's zone (e.g., us-central1-a)
#
# 5. VM name in ProxyCommand: "ansible-rhel9-vm"
#    â†’ Change to your actual VM name (appears twice in the file)

# =======================================================================
# AUTHENTICATION OPTIONS FOR DIFFERENT USERS:
# =======================================================================

# -----------------------------------------------------------------------
# OPTION A: PERSONAL ACCOUNT + IAP (Current Setup)
# -----------------------------------------------------------------------
personal_account_example:
  children:
    targets:
      hosts:
        YOUR-VM-NAME:
          ansible_host: YOUR-VM-NAME
          ansible_user: shivani_khetani                      # Your SSH user
          ansible_ssh_common_args: >-
            -o ProxyCommand="gcloud compute start-iap-tunnel YOUR-VM-NAME 22 
            --listen-on-stdin --project=YOUR-PROJECT --zone=YOUR-ZONE 
            --verbosity=warning" 
            -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null
          ansible_ssh_private_key_file: '/Users/shivani/.ssh/YOUR-KEY-FILE'
          ansible_python_interpreter: auto_silent

# -----------------------------------------------------------------------
# OPTION B: SERVICE ACCOUNT + IAP
# -----------------------------------------------------------------------
service_account_example:
  children:
    targets:
      hosts:
        YOUR-VM-NAME:
          ansible_host: YOUR-VM-NAME
          ansible_user: sa_SERVICE_ACCOUNT_ID                # Service account user ID
          ansible_ssh_common_args: >-
            -o ProxyCommand="gcloud compute start-iap-tunnel YOUR-VM-NAME 22 
            --listen-on-stdin --project=YOUR-PROJECT --zone=YOUR-ZONE 
            --impersonate-service-account=ansible-sa@YOUR-PROJECT.iam.gserviceaccount.com
            --verbosity=warning" 
            -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null
          ansible_python_interpreter: auto_silent

# -----------------------------------------------------------------------
# OPTION C: DIRECT SSH (No IAP) - If VM has external IP
# -----------------------------------------------------------------------
direct_ssh_example:
  children:
    targets:
      hosts:
        YOUR-VM-NAME:
          ansible_host: 34.XX.XX.XX                         # VM external IP
          ansible_user: shivani_khetani                      # Your SSH user
          ansible_ssh_common_args: '-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null'
          ansible_ssh_private_key_file: '/Users/shivani/.ssh/YOUR-KEY-FILE'
          ansible_python_interpreter: auto_silent

# =======================================================================
# STEP-BY-STEP SETUP FOR NEW USERS:
# =======================================================================

# STEP 1: Get your SSH username format
# - Usually: firstname_lastname (e.g., shivani_khetani)
# - Check with: gcloud compute os-login describe-profile
# - Or ask admin what SSH user format is used

# STEP 2: Create/Get SSH key pair
# ssh-keygen -t rsa -b 4096 -f ~/.ssh/ansible_key
# - Private key: ~/.ssh/ansible_key
# - Public key: ~/.ssh/ansible_key.pub

# STEP 3: Add SSH public key to VM or OS Login
# Option A: Add to OS Login (recommended)
# gcloud compute os-login ssh-keys add --key-file=~/.ssh/ansible_key.pub
# 
# Option B: Add to VM metadata
# gcloud compute instances add-metadata YOUR-VM-NAME \
#   --metadata-from-file ssh-keys=~/.ssh/ansible_key.pub

# STEP 4: Test SSH connection manually
# gcloud compute start-iap-tunnel YOUR-VM-NAME 22 \
#   --local-host-port=localhost:2222 --zone=YOUR-ZONE
# 
# # In another terminal:
# ssh -i ~/.ssh/ansible_key -p 2222 shivani_khetani@localhost

# STEP 5: Update this file with your values and test
# ansible all -i hosts.runtime.yml -m ping

# =======================================================================
# COMMON VALUES TO UPDATE:
# =======================================================================

# For Shivani Khetani specifically:
# ansible_user: "shivani_khetani"
# ansible_ssh_private_key_file: "/Users/shivani/.ssh/ansible_key"
# 
# Project & Infrastructure (get from admin):
# gcp_project: "shivani-project-123"  # Your GCP project
# gcp_zone: "us-central1-a"           # VM zone
# ansible_host: "shivani-test-vm"     # Your VM name

# =======================================================================
# QUICK VERIFICATION COMMANDS:
# =======================================================================

# Check your current gcloud configuration:
# gcloud config list

# List available projects:
# gcloud projects list

# List VMs in project:
# gcloud compute instances list

# Test IAP connectivity:
# gcloud compute start-iap-tunnel VM-NAME 22 --zone=ZONE --dry-run

# =======================================================================
